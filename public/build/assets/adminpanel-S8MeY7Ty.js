import{r,b as o,j as t,L as k}from"./app-CaMeP3M8.js";import{A as L}from"./app-layout-VG2RKsF-.js";import{B as h}from"./app-logo-icon-DBycB7GJ.js";import{D as N}from"./DataGrid-DBRDN6-O.js";import"./index-C7M6TDP0.js";import"./index-Sx6bqdWw.js";const D=[{title:"Админ панель",href:"/adminpanel"}];function M(){const[m,p]=r.useState([]),[u,x]=r.useState([]),[n,g]=r.useState(""),[l,v]=r.useState(""),[i,S]=r.useState(""),[j,s]=r.useState(null);r.useEffect(()=>{o.get("/roles").then(e=>{const d=e.data.users.map(a=>({...a,rolesString:a.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));p(e.data.roles),x(d)}).catch(e=>{console.error("Ошибка загрузки данных:",e),s("Не удалось загрузить данные с сервера.")})},[]);const R=()=>{if(!n.trim()){s("Название роли не может быть пустым.");return}o.post("/roles",{name:n}).then(e=>{alert(e.data.message),p([...m,e.data.role]),g("")}).catch(e=>{console.error("Ошибка при создании роли:",e),s("Не удалось создать роль.")})},w=()=>{if(!l||!i){s("Выберите пользователя и роль.");return}o.post("/roles/assign",{user_id:l,role_id:i}).then(e=>{alert(e.data.message),f()}).catch(e=>{console.error("Ошибка при назначении роли:",e),s("Не удалось назначить роль.")})},y=()=>{if(!l||!i){s("Выберите пользователя и роль для отмены.");return}o.post("/roles/revoke",{user_id:l,role_id:i}).then(e=>{alert(e.data.message),f()}).catch(e=>{console.error("Ошибка при отмене роли:",e),s("Не удалось отменить роль.")})},f=()=>{o.get("/roles").then(e=>{const d=e.data.users.map(a=>({...a,rolesString:a.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));x(d)}).catch(e=>{console.error("Ошибка обновления данных пользователей:",e)})},C=[{field:"id",headerName:"ID",width:100},{field:"name",headerName:"Имя",width:200},{field:"email",headerName:"Email",width:250},{field:"rolesString",headerName:"Роли",width:300}];return t.jsxs(L,{breadcrumbs:D,children:[t.jsx(k,{title:"Админ панель"}),t.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("h2",{children:"Управление ролями"}),j&&t.jsx("p",{style:{color:"red"},children:j}),t.jsxs("div",{children:[t.jsx("h3",{children:"Создать новую роль"}),t.jsx("input",{type:"text",value:n,onChange:e=>{g(e.target.value),s(null)},placeholder:"Название роли",style:{marginRight:"10px"}}),t.jsx(h,{onClick:R,children:"Создать"})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("h3",{children:"Назначить или отменить роль пользователю"}),t.jsxs("select",{onChange:e=>{v(e.target.value),s(null)},children:[t.jsx("option",{value:"",children:"Выберите пользователя"}),u.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{onChange:e=>{S(e.target.value),s(null)},style:{marginLeft:"10px"},children:[t.jsx("option",{value:"",children:"Выберите роль"}),m.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(h,{onClick:w,style:{marginLeft:"10px"},children:"Назначить"}),t.jsx(h,{onClick:y,style:{marginLeft:"10px",backgroundColor:"red"},children:"Отменить"})]}),t.jsxs("div",{style:{marginTop:"30px"},children:[t.jsx("h3",{children:"Список пользователей"}),t.jsx("div",{style:{height:400,width:"100%",overflowX:"auto"},children:t.jsx(N,{rows:u,columns:C,pageSizeOptions:[25,50,100],initialState:{pagination:{paginationModel:{pageSize:25,page:0}}},pagination:!0,sx:{"& .MuiDataGrid-root":{minWidth:"800px",overflowX:"auto"},"& .MuiDataGrid-columnHeaders":{width:"auto"}}})})]})]})})]})}export{M as default};
